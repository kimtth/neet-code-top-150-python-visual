<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>202 - Happy Number</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#202</span> Happy Number</h1>
            <p>
                A happy number is defined by repeatedly replacing the number with the sum of 
                squares of its digits until it equals 1 (happy) or loops endlessly (not happy).
                Use a set to detect cycles, or Floyd's cycle detection.
            </p>
            <div class="problem-meta">
                <span class="meta-tag">üî¢ Math</span>
                <span class="meta-tag">‚è±Ô∏è O(n)</span>
            </div>
            <div class="file-ref">
                üìÑ Python: <code>python/0202_happy_number/0202_happy_number.py</code>
            </div>

        </div>

        <div class="explanation-panel">
            <h4>üß† How It Works (Layman's Terms)</h4>
            <p>This algorithm solves the problem <strong>step by step</strong>:</p>
            <ul>
                <li><strong>Understand:</strong> Parse the input data</li>
                <li><strong>Process:</strong> Apply the core logic</li>
                <li><strong>Optimize:</strong> Use efficient data structures</li>
                <li><strong>Return:</strong> Output the computed result</li>
            </ul>
        </div>


        <section class="visualization-section">
            <h3>üé¨ Step-by-Step Visualization</h3>
            <div class="controls">
                <button id="autoRunBtn" class="btn">‚ñ∂ Auto Run</button>
                <button id="stepBtn" class="btn btn-success">Step</button>
                <button id="resetBtn" class="btn btn-danger">Reset</button>
                <label style="margin-left: 20px;">
                    Number: <input type="number" id="inputNum" value="19" min="1" max="999" style="width: 60px;">
                </label>
            </div>
            <div class="status" id="status">Check if 19 is a happy number</div>
            <svg id="visualization"></svg>
        </section>

        <section class="code-section">
            <h3>üíª Python Solution</h3>
            <div class="code-block">
                <pre><span class="keyword">def</span> <span class="function">isHappy</span>(n):
    <span class="keyword">def</span> <span class="function">sumOfSquares</span>(num):
        total = <span class="number">0</span>
        <span class="keyword">while</span> num > <span class="number">0</span>:
            digit = num % <span class="number">10</span>
            total += digit ** <span class="number">2</span>
            num //= <span class="number">10</span>
        <span class="keyword">return</span> total
    
    seen = <span class="function">set</span>()
    <span class="keyword">while</span> n != <span class="number">1</span> <span class="keyword">and</span> n <span class="keyword">not</span> <span class="keyword">in</span> seen:
        seen.<span class="function">add</span>(n)
        n = <span class="function">sumOfSquares</span>(n)
    
    <span class="keyword">return</span> n == <span class="number">1</span></pre>
            </div>
        </section>
    </div>

    <script>
        const width = 900;
        const height = 500;

        const svg = d3.select("#visualization")
            .attr("width", width)
            .attr("height", height);

        let inputNum = 19;
        let current;
        let history = [];
        let seen = new Set();
        let phase = "init";
        let animationTimer = null;
        let isHappy = null;

        document.getElementById("inputNum").addEventListener("change", (e) => {
            inputNum = parseInt(e.target.value) || 19;
            reset();
        });

        function sumOfSquares(num) {
            let total = 0;
            while (num > 0) {
                const digit = num % 10;
                total += digit * digit;
                num = Math.floor(num / 10);
            }
            return total;
        }

        function getDigits(num) {
            return num.toString().split('').map(Number);
        }

        function reset() {
            current = inputNum;
            history = [current];
            seen = new Set([current]);
            phase = "init";
            isHappy = null;
            
            if (animationTimer) clearInterval(animationTimer);
            animationTimer = null;
            document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
            document.getElementById("status").textContent = `Check if ${inputNum} is a happy number`;
            render();
        }

        function render() {
            svg.selectAll("*").remove();

            // Title
            svg.append("text")
                .attr("x", 30)
                .attr("y", 35)
                .attr("font-size", "14px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text(`Happy Number Check: ${inputNum}`);

            // Current calculation
            const calcY = 70;
            const digits = getDigits(current);
            
            svg.append("text")
                .attr("x", 30)
                .attr("y", calcY)
                .attr("font-size", "13px")
                .attr("font-weight", "bold")
                .attr("fill", "#64748b")
                .text("Current:");

            svg.append("rect")
                .attr("x", 100)
                .attr("y", calcY - 22)
                .attr("width", 80)
                .attr("height", 35)
                .attr("rx", 8)
                .attr("fill", current === 1 ? "#d1fae5" : "#fef3c7")
                .attr("stroke", current === 1 ? "#10b981" : "#f59e0b")
                .attr("stroke-width", 2);

            svg.append("text")
                .attr("x", 140)
                .attr("y", calcY + 2)
                .attr("text-anchor", "middle")
                .attr("font-size", "20px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text(current);

            // Show calculation breakdown
            if (phase !== "done") {
                svg.append("text")
                    .attr("x", 200)
                    .attr("y", calcY)
                    .attr("font-size", "14px")
                    .attr("fill", "#64748b")
                    .text(`= ${digits.map(d => `${d}¬≤`).join(' + ')} = ${digits.map(d => d*d).join(' + ')} = ${sumOfSquares(current)}`);
            }

            // History chain
            const historyY = 150;
            svg.append("text")
                .attr("x", 30)
                .attr("y", historyY)
                .attr("font-size", "13px")
                .attr("font-weight", "bold")
                .attr("fill", "#64748b")
                .text("Sequence:");

            const nodeWidth = 60;
            const spacing = 80;
            const startX = 30;

            history.forEach((num, idx) => {
                const x = startX + idx * spacing;
                const y = historyY + 30;
                const isLast = idx === history.length - 1;

                svg.append("circle")
                    .attr("cx", x + nodeWidth/2)
                    .attr("cy", y + 20)
                    .attr("r", 25)
                    .attr("fill", num === 1 ? "#d1fae5" : isLast ? "#fef3c7" : "#e0e7ff")
                    .attr("stroke", num === 1 ? "#10b981" : isLast ? "#f59e0b" : "#6366f1")
                    .attr("stroke-width", 2);

                svg.append("text")
                    .attr("x", x + nodeWidth/2)
                    .attr("y", y + 26)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "14px")
                    .attr("font-weight", "bold")
                    .attr("fill", "#1e293b")
                    .text(num);

                // Arrow to next
                if (idx < history.length - 1) {
                    svg.append("line")
                        .attr("x1", x + nodeWidth/2 + 28)
                        .attr("y1", y + 20)
                        .attr("x2", x + spacing + nodeWidth/2 - 28)
                        .attr("y2", y + 20)
                        .attr("stroke", "#94a3b8")
                        .attr("stroke-width", 2)
                        .attr("marker-end", "url(#arrow)");
                }
            });

            // Arrow marker
            svg.append("defs")
                .append("marker")
                .attr("id", "arrow")
                .attr("viewBox", "0 0 10 10")
                .attr("refX", 9)
                .attr("refY", 5)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M 0 0 L 10 5 L 0 10 z")
                .attr("fill", "#94a3b8");

            // Seen set
            const seenY = 280;
            svg.append("text")
                .attr("x", 30)
                .attr("y", seenY)
                .attr("font-size", "13px")
                .attr("font-weight", "bold")
                .attr("fill", "#64748b")
                .text(`Seen set: {${[...seen].join(', ')}}`);

            // Algorithm explanation
            svg.append("text")
                .attr("x", 30)
                .attr("y", 340)
                .attr("font-size", "13px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text("Algorithm:");

            const steps = [
                "1. Calculate sum of squares of digits",
                "2. If result is 1 ‚Üí Happy number!",
                "3. If result was seen before ‚Üí Cycle, not happy",
                "4. Otherwise, repeat with new number"
            ];

            steps.forEach((step, i) => {
                svg.append("text")
                    .attr("x", 30)
                    .attr("y", 365 + i * 22)
                    .attr("font-size", "12px")
                    .attr("fill", "#64748b")
                    .text(step);
            });

            // Result
            if (phase === "done") {
                const resultY = 450;
                svg.append("rect")
                    .attr("x", 400)
                    .attr("y", resultY - 35)
                    .attr("width", 350)
                    .attr("height", 55)
                    .attr("rx", 10)
                    .attr("fill", isHappy ? "#d1fae5" : "#fee2e2")
                    .attr("stroke", isHappy ? "#10b981" : "#ef4444")
                    .attr("stroke-width", 2);

                svg.append("text")
                    .attr("x", 575)
                    .attr("y", resultY)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "18px")
                    .attr("font-weight", "bold")
                    .attr("fill", isHappy ? "#10b981" : "#ef4444")
                    .text(isHappy ? `‚úì ${inputNum} is a Happy Number!` : `‚úó ${inputNum} is NOT Happy (cycle detected)`);
            }
        }

        function step() {
            if (phase === "done") return;

            if (current === 1) {
                isHappy = true;
                phase = "done";
                document.getElementById("status").textContent = `‚úì Reached 1! ${inputNum} is a happy number!`;
                render();
                return;
            }

            const next = sumOfSquares(current);
            
            if (seen.has(next)) {
                isHappy = false;
                phase = "done";
                history.push(next);
                document.getElementById("status").textContent = `‚úó Cycle detected! ${next} was seen before. Not a happy number.`;
                render();
                return;
            }

            seen.add(next);
            history.push(next);
            current = next;
            
            document.getElementById("status").textContent = 
                `Sum of squares: ${next}. Continuing...`;
            render();
        }

        function autoRun() {
            if (animationTimer) {
                clearInterval(animationTimer);
                animationTimer = null;
                document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
                return;
            }

            document.getElementById("autoRunBtn").textContent = "‚è∏ Pause";
            animationTimer = setInterval(() => {
                if (phase === "done") {
                    clearInterval(animationTimer);
                    animationTimer = null;
                    document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
                    return;
                }
                step();
            }, 800);
        }

        document.getElementById("autoRunBtn").addEventListener("click", autoRun);
        document.getElementById("stepBtn").addEventListener("click", step);
        document.getElementById("resetBtn").addEventListener("click", reset);

        reset();
    </script>
</body>
</html>
