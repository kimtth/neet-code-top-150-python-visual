<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>034 - Find First and Last Position</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#034</span> Find First and Last Position</h1>
            <p>
                Given a sorted array and a target value, find the starting and ending position 
                of target. Return [-1, -1] if not found. Use two binary searches: one for the 
                leftmost and one for the rightmost occurrence.
            </p>
            <div class="problem-meta">
                <span class="meta-tag">üîç Binary Search</span>
                <span class="meta-tag">‚è±Ô∏è O(n)</span>
            </div>
            <div class="file-ref">
                üìÑ Python: <code>python/0034_find_first_and_last_position_of_element_in_sorted_array/0034_find_first_and_last_position_of_element_in_sorted_array.py</code>
            </div>

        </div>

        <div class="explanation-panel">
            <h4>üß† How It Works (Layman's Terms)</h4>
            <p>This algorithm solves the problem <strong>step by step</strong>:</p>
            <ul>
                <li><strong>Understand:</strong> Parse the input data</li>
                <li><strong>Process:</strong> Apply the core logic</li>
                <li><strong>Optimize:</strong> Use efficient data structures</li>
                <li><strong>Return:</strong> Output the computed result</li>
            </ul>
        </div>


        <section class="visualization-section">
            <h3>üé¨ Step-by-Step Visualization</h3>
            <div class="controls">
                <button id="autoRunBtn" class="btn">‚ñ∂ Auto Run</button>
                <button id="stepBtn" class="btn btn-success">Step</button>
                <button id="resetBtn" class="btn btn-danger">Reset</button>
            </div>
            <div class="status" id="status">Find first and last position of target = 8</div>
            <svg id="visualization"></svg>
        </section>

        <section class="code-section">
            <h3>üíª Python Solution</h3>
            <div class="code-block">
                <pre><span class="keyword">def</span> <span class="function">searchRange</span>(nums, target):
    <span class="keyword">def</span> <span class="function">binarySearch</span>(leftBias):
        left, right = <span class="number">0</span>, <span class="function">len</span>(nums) - <span class="number">1</span>
        result = <span class="number">-1</span>
        
        <span class="keyword">while</span> left <= right:
            mid = (left + right) // <span class="number">2</span>
            <span class="keyword">if</span> nums[mid] < target:
                left = mid + <span class="number">1</span>
            <span class="keyword">elif</span> nums[mid] > target:
                right = mid - <span class="number">1</span>
            <span class="keyword">else</span>:
                result = mid
                <span class="keyword">if</span> leftBias:
                    right = mid - <span class="number">1</span>  <span class="comment"># Keep looking left</span>
                <span class="keyword">else</span>:
                    left = mid + <span class="number">1</span>   <span class="comment"># Keep looking right</span>
        
        <span class="keyword">return</span> result
    
    <span class="keyword">return</span> [<span class="function">binarySearch</span>(<span class="keyword">True</span>), <span class="function">binarySearch</span>(<span class="keyword">False</span>)]</pre>
            </div>
        </section>
    </div>

    <script>
        const width = 900;
        const height = 520;

        const svg = d3.select("#visualization")
            .attr("width", width)
            .attr("height", height);

        const nums = [5, 7, 7, 8, 8, 8, 8, 10];
        const target = 8;
        
        let phase = "findLeft";
        let left, right, mid;
        let leftResult = -1, rightResult = -1;
        let animationTimer = null;

        function reset() {
            phase = "findLeft";
            left = 0;
            right = nums.length - 1;
            mid = -1;
            leftResult = -1;
            rightResult = -1;
            
            if (animationTimer) clearInterval(animationTimer);
            animationTimer = null;
            document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
            document.getElementById("status").textContent = `Find first and last position of target = ${target}`;
            render();
        }

        function render() {
            svg.selectAll("*").remove();

            const cellWidth = 70;
            const startX = 100;
            const arrayY = 100;

            // Title
            svg.append("text")
                .attr("x", 30)
                .attr("y", 35)
                .attr("font-size", "14px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text(`Array: [${nums.join(', ')}]  |  Target: ${target}`);

            // Current phase
            svg.append("text")
                .attr("x", 30)
                .attr("y", 60)
                .attr("font-size", "13px")
                .attr("fill", "#6366f1")
                .text(phase === "findLeft" ? "Phase 1: Finding LEFTMOST occurrence" : 
                      phase === "findRight" ? "Phase 2: Finding RIGHTMOST occurrence" : "Complete!");

            // Draw array
            nums.forEach((num, idx) => {
                const x = startX + idx * cellWidth;
                const isMid = idx === mid;
                const isInRange = idx >= left && idx <= right;
                const isTarget = num === target;
                const isLeftResult = idx === leftResult;
                const isRightResult = idx === rightResult;

                svg.append("rect")
                    .attr("x", x)
                    .attr("y", arrayY)
                    .attr("width", cellWidth - 8)
                    .attr("height", 50)
                    .attr("rx", 8)
                    .attr("fill", () => {
                        if (isLeftResult || isRightResult) return "#d1fae5";
                        if (isMid) return "#fef3c7";
                        if (isInRange && phase !== "done") return "#dbeafe";
                        return "#f1f5f9";
                    })
                    .attr("stroke", () => {
                        if (isLeftResult || isRightResult) return "#10b981";
                        if (isMid) return "#f59e0b";
                        if (isInRange && phase !== "done") return "#3b82f6";
                        return "#94a3b8";
                    })
                    .attr("stroke-width", isMid ? 3 : 2);

                svg.append("text")
                    .attr("x", x + (cellWidth - 8) / 2)
                    .attr("y", arrayY + 32)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "18px")
                    .attr("font-weight", "bold")
                    .attr("fill", isTarget ? "#10b981" : "#1e293b")
                    .text(num);

                // Index
                svg.append("text")
                    .attr("x", x + (cellWidth - 8) / 2)
                    .attr("y", arrayY + 70)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "11px")
                    .attr("fill", "#64748b")
                    .text(idx);
            });

            // Pointer labels
            if (phase !== "done") {
                if (left >= 0 && left < nums.length) {
                    svg.append("text")
                        .attr("x", startX + left * cellWidth + (cellWidth - 8) / 2)
                        .attr("y", arrayY - 15)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "11px")
                        .attr("font-weight", "bold")
                        .attr("fill", "#3b82f6")
                        .text("L");
                }

                if (right >= 0 && right < nums.length) {
                    svg.append("text")
                        .attr("x", startX + right * cellWidth + (cellWidth - 8) / 2)
                        .attr("y", arrayY - 15)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "11px")
                        .attr("font-weight", "bold")
                        .attr("fill", "#ec4899")
                        .text("R");
                }

                if (mid >= 0) {
                    svg.append("text")
                        .attr("x", startX + mid * cellWidth + (cellWidth - 8) / 2)
                        .attr("y", arrayY + 95)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "11px")
                        .attr("font-weight", "bold")
                        .attr("fill", "#f59e0b")
                        .text("mid");
                }
            }

            // Binary search state
            if (phase !== "done") {
                const stateY = 230;
                svg.append("rect")
                    .attr("x", 30)
                    .attr("y", stateY)
                    .attr("width", 400)
                    .attr("height", 70)
                    .attr("rx", 10)
                    .attr("fill", "#eff6ff")
                    .attr("stroke", "#3b82f6");

                svg.append("text")
                    .attr("x", 50)
                    .attr("y", stateY + 25)
                    .attr("font-size", "13px")
                    .attr("fill", "#1e293b")
                    .text(`left = ${left}, right = ${right}, mid = ${mid >= 0 ? mid : '?'}`);

                if (mid >= 0) {
                    svg.append("text")
                        .attr("x", 50)
                        .attr("y", stateY + 50)
                        .attr("font-size", "13px")
                        .attr("fill", "#1e293b")
                        .text(`nums[${mid}] = ${nums[mid]} vs target = ${target}`);
                }
            }

            // Results
            const resultY = 330;
            svg.append("text")
                .attr("x", 30)
                .attr("y", resultY)
                .attr("font-size", "14px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text("Results:");

            svg.append("text")
                .attr("x", 30)
                .attr("y", resultY + 30)
                .attr("font-size", "13px")
                .attr("fill", leftResult >= 0 ? "#10b981" : "#94a3b8")
                .text(`First position: ${leftResult >= 0 ? leftResult : 'searching...'}`);

            svg.append("text")
                .attr("x", 30)
                .attr("y", resultY + 55)
                .attr("font-size", "13px")
                .attr("fill", rightResult >= 0 ? "#10b981" : "#94a3b8")
                .text(`Last position: ${rightResult >= 0 ? rightResult : (phase === 'findRight' ? 'searching...' : 'pending')}`);

            // Algorithm explanation
            const algoX = 480;
            svg.append("text")
                .attr("x", algoX)
                .attr("y", 230)
                .attr("font-size", "13px")
                .attr("font-weight", "bold")
                .attr("fill", "#1e293b")
                .text("Two Binary Searches:");

            const steps = [
                "1. Find leftmost: when found, keep",
                "   searching left (right = mid - 1)",
                "",
                "2. Find rightmost: when found, keep",
                "   searching right (left = mid + 1)"
            ];

            steps.forEach((step, i) => {
                svg.append("text")
                    .attr("x", algoX)
                    .attr("y", 255 + i * 20)
                    .attr("font-size", "12px")
                    .attr("fill", "#64748b")
                    .text(step);
            });

            // Final result
            if (phase === "done") {
                svg.append("rect")
                    .attr("x", 30)
                    .attr("y", 430)
                    .attr("width", 400)
                    .attr("height", 55)
                    .attr("rx", 10)
                    .attr("fill", "#d1fae5")
                    .attr("stroke", "#10b981")
                    .attr("stroke-width", 2);

                svg.append("text")
                    .attr("x", 230)
                    .attr("y", 465)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "18px")
                    .attr("font-weight", "bold")
                    .attr("fill", "#10b981")
                    .text(`‚úì Result: [${leftResult}, ${rightResult}]`);
            }
        }

        function step() {
            if (phase === "done") return;

            if (phase === "findLeft") {
                if (left <= right) {
                    mid = Math.floor((left + right) / 2);
                    
                    if (nums[mid] < target) {
                        document.getElementById("status").textContent = 
                            `nums[${mid}]=${nums[mid]} < ${target}, search right`;
                        left = mid + 1;
                    } else if (nums[mid] > target) {
                        document.getElementById("status").textContent = 
                            `nums[${mid}]=${nums[mid]} > ${target}, search left`;
                        right = mid - 1;
                    } else {
                        leftResult = mid;
                        document.getElementById("status").textContent = 
                            `Found target at ${mid}! Keep searching LEFT for first occurrence`;
                        right = mid - 1;
                    }
                } else {
                    // Switch to finding right
                    phase = "findRight";
                    left = 0;
                    right = nums.length - 1;
                    mid = -1;
                    document.getElementById("status").textContent = 
                        `First position found: ${leftResult}. Now finding last position...`;
                }
            } else if (phase === "findRight") {
                if (left <= right) {
                    mid = Math.floor((left + right) / 2);
                    
                    if (nums[mid] < target) {
                        document.getElementById("status").textContent = 
                            `nums[${mid}]=${nums[mid]} < ${target}, search right`;
                        left = mid + 1;
                    } else if (nums[mid] > target) {
                        document.getElementById("status").textContent = 
                            `nums[${mid}]=${nums[mid]} > ${target}, search left`;
                        right = mid - 1;
                    } else {
                        rightResult = mid;
                        document.getElementById("status").textContent = 
                            `Found target at ${mid}! Keep searching RIGHT for last occurrence`;
                        left = mid + 1;
                    }
                } else {
                    phase = "done";
                    document.getElementById("status").textContent = 
                        `‚úì Complete! Range: [${leftResult}, ${rightResult}]`;
                }
            }

            render();
        }

        function autoRun() {
            if (animationTimer) {
                clearInterval(animationTimer);
                animationTimer = null;
                document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
                return;
            }

            document.getElementById("autoRunBtn").textContent = "‚è∏ Pause";
            animationTimer = setInterval(() => {
                if (phase === "done") {
                    clearInterval(animationTimer);
                    animationTimer = null;
                    document.getElementById("autoRunBtn").textContent = "‚ñ∂ Auto Run";
                    return;
                }
                step();
            }, 1000);
        }

        document.getElementById("autoRunBtn").addEventListener("click", autoRun);
        document.getElementById("stepBtn").addEventListener("click", step);
        document.getElementById("resetBtn").addEventListener("click", reset);

        reset();
    </script>
</body>
</html>
