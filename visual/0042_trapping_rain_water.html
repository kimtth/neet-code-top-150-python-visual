<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LC 42: Trapping Rain Water - Algorithm Visualization</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#42</span> Trapping Rain Water</h1>
            <p>Given n non-negative integers representing an elevation map where width of each bar is 1, compute how much water it can trap after raining.</p>
            <div class="problem-meta">
                <span class="meta-tag">üìÅ Array</span>
                <span class="meta-tag">üëâüëà Two Pointers</span>
                <span class="meta-tag">‚è±Ô∏è O(n)</span>
                <span class="meta-tag">üíæ O(1)</span>
            </div>
            <div class="file-ref">
                üìÑ Python: <code>python/0042_trapping_rain_water/0042_trapping_rain_water.py</code>
            </div>
            </div>

        <div class="explanation-panel">
            <h4>üß† How It Works (Layman's Terms)</h4>
            <p>Imagine the elevation map as valleys between mountains. Water fills in the valleys.</p>
            <ul>
                <li><strong>Key insight:</strong> Water at any position = min(max_left, max_right) - current_height</li>
                <li><strong>Two pointers:</strong> Start from both ends, track max heights seen from each side</li>
                <li><strong>Move the smaller side:</strong> If left_max < right_max, water level at left is limited by left_max</li>
                <li><strong>Calculate trapped:</strong> At each position, water = max_on_this_side - height</li>
            </ul>
        </div>


        <div class="visualization-section">
            <h3>üé¨ Step-by-Step Visualization</h3>
            
            <div class="controls">
                <button class="btn btn-primary" id="stepBtn" onclick="step()">Step</button>
                <button class="btn btn-success" id="autoBtn" onclick="toggleAuto()">Auto Run</button>
                <button class="btn btn-warning" onclick="reset()">Reset</button>
            </div>

            <div class="status-message" id="statusMessage">
                Click "Step" or "Auto Run" to start visualization
            </div>

            <div class="variable-display">
                <div class="variable-box">
                    <div class="variable-name">Left Max</div>
                    <div class="variable-value" id="leftMax" style="color: #ff5722;">0</div>
                </div>
                <div class="variable-box">
                    <div class="variable-name">Right Max</div>
                    <div class="variable-value" id="rightMax" style="color: #3f51b5;">0</div>
                </div>
                <div class="variable-box">
                    <div class="variable-name">Water Added</div>
                    <div class="variable-value" id="waterAdded">0</div>
                </div>
                <div class="variable-box">
                    <div class="variable-name">Total Water</div>
                    <div class="variable-value" id="totalWater" style="color: #2196f3;">0</div>
                </div>
            </div>

            <div class="svg-container">
                <svg id="visualization" width="750" height="350"></svg>
            </div>
        </div>

        <div class="code-section">
            <h3>üíª Python Solution (Two Pointers)</h3>
            <div class="code-block">
                <pre><span class="keyword">def</span> <span class="function">trap</span>(self, height: List[<span class="class-name">int</span>]) -> <span class="class-name">int</span>:
    left, right = <span class="number">0</span>, <span class="function">len</span>(height) - <span class="number">1</span>
    left_max = height[left]
    right_max = height[right]
    trapped_water = <span class="number">0</span>
    
    <span class="keyword">while</span> left < right:
        <span class="keyword">if</span> left_max < right_max:
            left += <span class="number">1</span>
            left_max = <span class="function">max</span>(left_max, height[left])
            trapped_water += left_max - height[left]
        <span class="keyword">else</span>:
            right -= <span class="number">1</span>
            right_max = <span class="function">max</span>(right_max, height[right])
            trapped_water += right_max - height[right]
            
    <span class="keyword">return</span> trapped_water</pre>
            </div>
        </div>
    </div>

    <script>
        const heights = [0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1];
        let left = 0;
        let right = heights.length - 1;
        let leftMax = heights[0];
        let rightMax = heights[heights.length - 1];
        let totalWater = 0;
        let waterAtPositions = new Array(heights.length).fill(0);
        let autoInterval = null;

        const svg = d3.select("#visualization");
        const margin = { top: 30, right: 30, bottom: 50, left: 50 };
        const width = 750 - margin.left - margin.right;
        const height = 300 - margin.top - margin.bottom;

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const xScale = d3.scaleBand()
            .domain(heights.map((_, i) => i))
            .range([0, width])
            .padding(0.1);

        const yScale = d3.scaleLinear()
            .domain([0, Math.max(...heights) + 1])
            .range([height, 0]);

        // Add axes
        g.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale));

        g.append("g")
            .call(d3.axisLeft(yScale));

        function render() {
            // Clear previous elements
            g.selectAll(".bar").remove();
            g.selectAll(".water-bar").remove();
            g.selectAll(".pointer-label").remove();

            // Draw water first (behind bars)
            g.selectAll(".water-bar")
                .data(waterAtPositions)
                .enter()
                .append("rect")
                .attr("class", "water-bar")
                .attr("x", (d, i) => xScale(i))
                .attr("y", (d, i) => yScale(heights[i] + d))
                .attr("width", xScale.bandwidth())
                .attr("height", (d, i) => d > 0 ? height - yScale(d) : 0)
                .attr("fill", "rgba(33, 150, 243, 0.6)")
                .attr("stroke", "#1976d2");

            // Draw bars
            g.selectAll(".bar")
                .data(heights)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", (d, i) => xScale(i))
                .attr("y", d => yScale(d))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d))
                .attr("fill", (d, i) => {
                    if (i === left) return "#ff5722";
                    if (i === right) return "#3f51b5";
                    return "#795548";
                })
                .attr("stroke", "#333")
                .attr("stroke-width", 1);

            // Add pointer labels
            g.append("text")
                .attr("class", "pointer-label")
                .attr("x", xScale(left) + xScale.bandwidth() / 2)
                .attr("y", height + 35)
                .attr("text-anchor", "middle")
                .attr("fill", "#ff5722")
                .attr("font-weight", "bold")
                .text("L");

            g.append("text")
                .attr("class", "pointer-label")
                .attr("x", xScale(right) + xScale.bandwidth() / 2)
                .attr("y", height + 35)
                .attr("text-anchor", "middle")
                .attr("fill", "#3f51b5")
                .attr("font-weight", "bold")
                .text("R");

            document.getElementById('leftMax').textContent = leftMax;
            document.getElementById('rightMax').textContent = rightMax;
            document.getElementById('totalWater').textContent = totalWater;
        }

        function step() {
            if (left >= right) {
                document.getElementById('statusMessage').className = 'status-message success';
                document.getElementById('statusMessage').textContent = 
                    `‚úÖ Done! Total trapped water = ${totalWater} units`;
                document.getElementById('stepBtn').disabled = true;
                stopAuto();
                return;
            }

            let waterAdded = 0;
            let message = '';

            if (leftMax < rightMax) {
                left++;
                leftMax = Math.max(leftMax, heights[left]);
                waterAdded = leftMax - heights[left];
                waterAtPositions[left] = waterAdded;
                totalWater += waterAdded;
                message = `Left side: leftMax(${leftMax}) < rightMax(${rightMax}). ` +
                         `Water at [${left}] = ${leftMax} - ${heights[left]} = ${waterAdded}`;
            } else {
                right--;
                rightMax = Math.max(rightMax, heights[right]);
                waterAdded = rightMax - heights[right];
                waterAtPositions[right] = waterAdded;
                totalWater += waterAdded;
                message = `Right side: rightMax(${rightMax}) ‚â§ leftMax(${leftMax}). ` +
                         `Water at [${right}] = ${rightMax} - ${heights[right]} = ${waterAdded}`;
            }

            document.getElementById('waterAdded').textContent = waterAdded;
            document.getElementById('statusMessage').textContent = message;

            render();
        }

        function toggleAuto() {
            if (autoInterval) {
                stopAuto();
            } else {
                document.getElementById('autoBtn').textContent = 'Pause';
                autoInterval = setInterval(() => {
                    if (left >= right) {
                        step();
                        stopAuto();
                    } else {
                        step();
                    }
                }, 800);
            }
        }

        function stopAuto() {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }
            document.getElementById('autoBtn').textContent = 'Auto Run';
        }

        function reset() {
            stopAuto();
            left = 0;
            right = heights.length - 1;
            leftMax = heights[0];
            rightMax = heights[heights.length - 1];
            totalWater = 0;
            waterAtPositions = new Array(heights.length).fill(0);
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('statusMessage').className = 'status-message';
            document.getElementById('statusMessage').textContent = 'Click "Step" or "Auto Run" to start visualization';
            document.getElementById('waterAdded').textContent = '0';
            render();
        }

        render();
    </script>
</body>
</html>
