<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next Permutation - LeetCode 31</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#31</span> Next Permutation</h1>
            <p>Rearrange numbers into the lexicographically next greater permutation.</p>
            <div class="problem-meta">
                <span class="meta-tag">Array</span>
                <span class="meta-tag">Two Pointers</span>
                <span class="meta-tag">Medium</span>
            </div>
            <div class="file-ref">
                ðŸ“„ Python: <code>python/0031_next_permutation/0031_next_permutation.py</code>
            </div>

        </div>

        <div class="explanation-panel">
            <h4>ðŸ§  How It Works (Layman's Terms)</h4>
            <p>Backtracking <strong>explores all possibilities</strong> like solving a maze:</p>
            <ul>
                <li><strong>Choose:</strong> Make a decision</li>
                <li><strong>Explore:</strong> Recursively continue</li>
                <li><strong>Validate:</strong> Check if path is valid</li>
                <li><strong>Backtrack:</strong> Undo choice if stuck, try another</li>
            </ul>
        </div>


        <div class="visualization-section">
            <h3>ðŸŽ¬ Step-by-Step Visualization</h3>
            <div class="controls">
                <button id="stepBtn">Step</button>
                <button id="autoBtn">Auto Run</button>
                <button id="resetBtn">Reset</button>
            </div>
            <svg id="mainSvg" width="800" height="400"></svg>
            <div class="status-message" id="status">Click "Step" to find next permutation</div>
        </div>

        <div class="code-section">
            <h3>Python Solution</h3>
            <pre><span class="keyword">def</span> <span class="function">nextPermutation</span>(nums):
    <span class="comment"># Step 1: Find first decreasing element from right</span>
    i = <span class="function">len</span>(nums) - <span class="number">2</span>
    <span class="keyword">while</span> i >= <span class="number">0</span> <span class="keyword">and</span> nums[i] >= nums[i + <span class="number">1</span>]:
        i -= <span class="number">1</span>
    
    <span class="keyword">if</span> i >= <span class="number">0</span>:
        <span class="comment"># Step 2: Find element just larger than nums[i]</span>
        j = <span class="function">len</span>(nums) - <span class="number">1</span>
        <span class="keyword">while</span> nums[j] <= nums[i]:
            j -= <span class="number">1</span>
        <span class="comment"># Step 3: Swap</span>
        nums[i], nums[j] = nums[j], nums[i]
    
    <span class="comment"># Step 4: Reverse suffix starting at i+1</span>
    left, right = i + <span class="number">1</span>, <span class="function">len</span>(nums) - <span class="number">1</span>
    <span class="keyword">while</span> left < right:
        nums[left], nums[right] = nums[right], nums[left]
        left, right = left + <span class="number">1</span>, right - <span class="number">1</span></pre>
        </div>
    </div>

    <script>
        const originalNums = [1, 3, 5, 4, 2];
        let nums = [...originalNums];
        
        let phase = 'find_i';
        let i, j;
        let left, right;
        
        const width = 800, height = 400;
        const svg = d3.select("#mainSvg");
        let autoTimer = null;
        let autoRunning = false;

        function draw() {
            svg.selectAll("*").remove();

            const cellWidth = 70, startX = 150, startY = 100;

            // Title
            svg.append("text")
                .attr("x", width / 2).attr("y", 30)
                .attr("text-anchor", "middle")
                .attr("font-weight", "bold")
                .text(`Finding Next Permutation of [${originalNums.join(", ")}]`);

            // Draw array
            nums.forEach((num, idx) => {
                const x = startX + idx * cellWidth;
                let fill = "#e3f2fd", stroke = "#1976d2";

                if (phase === 'find_i' && idx === i) {
                    fill = "#fff3e0"; stroke = "#ff9800";
                } else if (phase === 'find_j') {
                    if (idx === i) { fill = "#fff3e0"; stroke = "#ff9800"; }
                    if (idx === j) { fill = "#e8f5e9"; stroke = "#4caf50"; }
                } else if (phase === 'swap' || phase === 'swapped') {
                    if (idx === i || idx === j) {
                        fill = "#fce4ec"; stroke = "#e91e63";
                    }
                } else if (phase === 'reverse') {
                    if (idx === left || idx === right) {
                        fill = "#e1f5fe"; stroke = "#03a9f4";
                    } else if (idx > i && idx < left) {
                        fill = "#e0e0e0";
                    } else if (idx > right && idx < nums.length) {
                        fill = "#e0e0e0";
                    }
                }

                svg.append("rect")
                    .attr("x", x).attr("y", startY)
                    .attr("width", cellWidth - 5).attr("height", 55)
                    .attr("rx", 8)
                    .attr("fill", fill).attr("stroke", stroke)
                    .attr("stroke-width", 2);

                svg.append("text")
                    .attr("x", x + (cellWidth - 5) / 2)
                    .attr("y", startY + 35)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "24px")
                    .attr("font-weight", "bold")
                    .text(num);

                svg.append("text")
                    .attr("x", x + (cellWidth - 5) / 2)
                    .attr("y", startY + 70)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "11px")
                    .attr("fill", "#666")
                    .text(`[${idx}]`);
            });

            // Pointers
            if (i !== undefined && i >= 0 && phase !== 'done') {
                svg.append("text")
                    .attr("x", startX + i * cellWidth + (cellWidth - 5) / 2)
                    .attr("y", startY - 15)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "12px")
                    .attr("fill", "#ff9800")
                    .text("â–¼ i");
            }

            if (j !== undefined && phase === 'find_j') {
                svg.append("text")
                    .attr("x", startX + j * cellWidth + (cellWidth - 5) / 2)
                    .attr("y", startY - 15)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "12px")
                    .attr("fill", "#4caf50")
                    .text("â–¼ j");
            }

            if (phase === 'reverse' && left !== undefined && right !== undefined) {
                svg.append("text")
                    .attr("x", startX + left * cellWidth + (cellWidth - 5) / 2)
                    .attr("y", startY - 15)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "11px")
                    .attr("fill", "#03a9f4")
                    .text("L");

                svg.append("text")
                    .attr("x", startX + right * cellWidth + (cellWidth - 5) / 2)
                    .attr("y", startY - 15)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "11px")
                    .attr("fill", "#03a9f4")
                    .text("R");
            }

            // Algorithm steps
            const stepsY = 220;
            const steps = [
                { text: "1. Find first decreasing from right (i)", active: phase === 'find_i' },
                { text: "2. Find element just larger than nums[i] (j)", active: phase === 'find_j' },
                { text: "3. Swap nums[i] and nums[j]", active: phase === 'swap' || phase === 'swapped' },
                { text: "4. Reverse suffix after i", active: phase === 'reverse' }
            ];

            steps.forEach((step, idx) => {
                svg.append("rect")
                    .attr("x", 100).attr("y", stepsY + idx * 35)
                    .attr("width", 320).attr("height", 28)
                    .attr("rx", 5)
                    .attr("fill", step.active ? "#e8f5e9" : "#f5f5f5")
                    .attr("stroke", step.active ? "#4caf50" : "#ddd");

                svg.append("text")
                    .attr("x", 110).attr("y", stepsY + idx * 35 + 19)
                    .attr("font-size", "13px")
                    .attr("fill", step.active ? "#2e7d32" : "#666")
                    .text(step.text);
            });

            // Result
            if (phase === 'done') {
                svg.append("rect")
                    .attr("x", 450).attr("y", stepsY + 40)
                    .attr("width", 280).attr("height", 60)
                    .attr("rx", 10)
                    .attr("fill", "#d1fae5").attr("stroke", "#10b981")
                    .attr("stroke-width", 2);

                svg.append("text")
                    .attr("x", 590).attr("y", stepsY + 65)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "14px")
                    .text("Next Permutation:");

                svg.append("text")
                    .attr("x", 590).attr("y", stepsY + 90)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "20px")
                    .attr("font-weight", "bold")
                    .attr("fill", "#10b981")
                    .text(`[${nums.join(", ")}]`);
            }
        }

        function step() {
            if (phase === 'done') return false;

            if (phase === 'find_i') {
                if (i === undefined) i = nums.length - 2;
                
                if (i >= 0 && nums[i] >= nums[i + 1]) {
                    document.getElementById("status").textContent = 
                        `nums[${i}]=${nums[i]} >= nums[${i+1}]=${nums[i+1]}, continue searching...`;
                    i--;
                } else if (i >= 0) {
                    document.getElementById("status").textContent = 
                        `Found i=${i} where nums[${i}]=${nums[i]} < nums[${i+1}]=${nums[i+1]}`;
                    phase = 'find_j';
                    j = nums.length - 1;
                } else {
                    document.getElementById("status").textContent = 
                        "Array is in descending order, will reverse entire array";
                    phase = 'reverse';
                    left = 0;
                    right = nums.length - 1;
                }
            } else if (phase === 'find_j') {
                if (nums[j] <= nums[i]) {
                    document.getElementById("status").textContent = 
                        `nums[${j}]=${nums[j]} <= nums[${i}]=${nums[i]}, continue...`;
                    j--;
                } else {
                    document.getElementById("status").textContent = 
                        `Found j=${j} where nums[${j}]=${nums[j]} > nums[${i}]=${nums[i]}`;
                    phase = 'swap';
                }
            } else if (phase === 'swap') {
                [nums[i], nums[j]] = [nums[j], nums[i]];
                document.getElementById("status").textContent = 
                    `Swapped nums[${i}] and nums[${j}]. Array: [${nums.join(", ")}]`;
                phase = 'swapped';
            } else if (phase === 'swapped') {
                phase = 'reverse';
                left = i + 1;
                right = nums.length - 1;
                document.getElementById("status").textContent = 
                    `Now reversing suffix from index ${left} to ${right}`;
            } else if (phase === 'reverse') {
                if (left < right) {
                    [nums[left], nums[right]] = [nums[right], nums[left]];
                    document.getElementById("status").textContent = 
                        `Swapped positions ${left} and ${right}`;
                    left++;
                    right--;
                } else {
                    phase = 'done';
                    document.getElementById("status").textContent = 
                        `Done! Next permutation: [${nums.join(", ")}]`;
                }
            }

            draw();
            return phase !== 'done';
        }

        function reset() {
            nums = [...originalNums];
            phase = 'find_i';
            i = undefined;
            j = undefined;
            left = undefined;
            right = undefined;
            if (autoTimer) clearInterval(autoTimer);
            autoRunning = false;
            document.getElementById("autoBtn").textContent = "Auto Run";
            document.getElementById("status").textContent = 'Click "Step" to find next permutation';
            draw();
        }

        function autoRun() {
            if (autoRunning) {
                clearInterval(autoTimer);
                autoRunning = false;
                document.getElementById("autoBtn").textContent = "Auto Run";
            } else {
                autoRunning = true;
                document.getElementById("autoBtn").textContent = "Pause";
                autoTimer = setInterval(() => {
                    if (!step()) {
                        clearInterval(autoTimer);
                        autoRunning = false;
                        document.getElementById("autoBtn").textContent = "Auto Run";
                    }
                }, 800);
            }
        }

        document.getElementById("stepBtn").addEventListener("click", step);
        document.getElementById("autoBtn").addEventListener("click", autoRun);
        document.getElementById("resetBtn").addEventListener("click", reset);

        reset();
    </script>
</body>
</html>
