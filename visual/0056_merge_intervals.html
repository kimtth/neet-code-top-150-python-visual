<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LC 56: Merge Intervals - Algorithm Visualization</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#56</span> Merge Intervals</h1>
            <p>Given an array of intervals, merge all overlapping intervals and return an array of non-overlapping intervals that cover all the intervals in the input.</p>
            <div class="problem-meta">
                <span class="meta-tag">ğŸ“… Intervals</span>
                <span class="meta-tag">ğŸ”¢ Sorting</span>
                <span class="meta-tag">â±ï¸ O(n log n)</span>
                <span class="meta-tag">ğŸ’¾ O(n)</span>
            </div>
            <div class="file-ref">
                ğŸ“„ Python: <code>python/0056_merge_intervals/0056_merge_intervals.py</code>
            </div>
            </div>

        <div class="explanation-panel">
            <h4>ğŸ§  How It Works (Layman's Terms)</h4>
            <p>Think of merging meeting times on a calendar:</p>
            <ul>
                <li><strong>First:</strong> Sort intervals by start time (so we process in order)</li>
                <li><strong>For each interval:</strong> Compare with the last merged interval</li>
                <li><strong>If overlapping:</strong> Extend the end time of the last interval</li>
                <li><strong>If not overlapping:</strong> Add as a new separate interval</li>
                <li><strong>Key insight:</strong> Two intervals overlap if current.start â‰¤ prev.end</li>
            </ul>
        </div>


        <div class="visualization-section">
            <h3>ğŸ¬ Step-by-Step Visualization</h3>
            
            <div class="controls">
                <button class="btn btn-primary" id="stepBtn" onclick="step()">Step</button>
                <button class="btn btn-success" id="autoBtn" onclick="toggleAuto()">Auto Run</button>
                <button class="btn btn-warning" onclick="reset()">Reset</button>
            </div>

            <div class="info-box secondary" style="margin-bottom: 20px;">
                ğŸ“… Intervals: <strong>[[1,3], [2,6], [8,10], [15,18]]</strong>
            </div>

            <div class="status-message" id="statusMessage">
                Click "Step" or "Auto Run" to start visualization
            </div>

            <div id="timelineContainer" style="width: 100%; height: 200px; margin-top: 20px;"></div>

            <div style="display: flex; gap: 30px; margin-top: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 250px;">
                    <div class="array-section">
                        <div class="array-label">ğŸ“¥ Input Intervals (sorted):</div>
                        <div id="inputContainer" style="display: flex; flex-direction: column; gap: 8px; padding: 10px; background: #f5f5f5; border-radius: 8px;"></div>
                    </div>
                </div>
                <div style="flex: 1; min-width: 250px;">
                    <div class="array-section">
                        <div class="array-label">ğŸ“¤ Merged Result:</div>
                        <div id="resultContainer" style="display: flex; flex-direction: column; gap: 8px; padding: 10px; background: #e8f5e9; border-radius: 8px;"></div>
                    </div>
                </div>
            </div>

            <div class="explanation-panel" style="margin-top: 20px;">
                <h4>ğŸ“ Current Comparison</h4>
                <div id="comparisonDisplay" style="font-size: 1.1em; padding: 10px;">
                    Waiting to start...
                </div>
            </div>
        </div>
        <div class="code-section">
            <h3>ğŸ’» Python Solution</h3>
            <div class="code-block">
                <pre><span class="keyword">def</span> <span class="function">merge</span>(self, intervals):
    intervals.<span class="function">sort</span>(key=<span class="keyword">lambda</span> x: <span class="class-name">x</span>[<span class="number">0</span>])
    result = [intervals[<span class="number">0</span>]]
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1</span>, <span class="function">len</span>(intervals)):
        current = intervals[i]
        prev = result[<span class="number">-1</span>]
        
        <span class="keyword">if</span> current[<span class="number">0</span>] <= prev[<span class="number">1</span>]:  <span class="comment"># Overlapping</span>
            prev[<span class="number">1</span>] = <span class="function">max</span>(prev[<span class="number">1</span>], current[<span class="number">1</span>])
        <span class="keyword">else</span>:  <span class="comment"># No overlap</span>
            result.<span class="function">append</span>(current)
    
    <span class="keyword">return</span> result</pre>
            </div>
        </div>
    </div>

    <script>
        const intervals = [[1,3], [2,6], [8,10], [15,18]];
        let result = [];
        let currentIdx = -1;
        let autoInterval = null;
        const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];

        function init() {
            result = [];
            renderTimeline();
            renderInput();
            renderResult();
        }

        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            const width = container.offsetWidth;
            const height = 180;
            
            d3.select('#timelineContainer').selectAll('*').remove();
            
            const svg = d3.select('#timelineContainer')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const margin = {left: 40, right: 40};
            const chartWidth = width - margin.left - margin.right;
            
            // Find range
            const maxVal = Math.max(...intervals.flat(), ...result.flat()) + 2;
            
            const xScale = d3.scaleLinear()
                .domain([0, maxVal])
                .range([margin.left, margin.left + chartWidth]);

            // Axis
            svg.append('g')
                .attr('transform', `translate(0, ${height - 30})`)
                .call(d3.axisBottom(xScale).ticks(maxVal));

            // Draw original intervals (top row)
            svg.append('text')
                .attr('x', 10)
                .attr('y', 25)
                .attr('font-size', '12px')
                .attr('fill', '#666')
                .text('Original:');

            intervals.forEach((interval, i) => {
                const y = 40;
                const isProcessed = i <= currentIdx;
                const isCurrent = i === currentIdx;
                
                svg.append('rect')
                    .attr('x', xScale(interval[0]))
                    .attr('y', y)
                    .attr('width', xScale(interval[1]) - xScale(interval[0]))
                    .attr('height', 25)
                    .attr('fill', isCurrent ? '#ff9800' : (isProcessed ? '#c8e6c9' : '#e0e0e0'))
                    .attr('stroke', isCurrent ? '#e65100' : (isProcessed ? '#4caf50' : '#999'))
                    .attr('stroke-width', isCurrent ? 3 : 1)
                    .attr('rx', 5);

                svg.append('text')
                    .attr('x', (xScale(interval[0]) + xScale(interval[1])) / 2)
                    .attr('y', y + 17)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '11px')
                    .attr('fill', '#333')
                    .text(`[${interval[0]},${interval[1]}]`);
            });

            // Draw merged intervals (bottom row)
            svg.append('text')
                .attr('x', 10)
                .attr('y', 95)
                .attr('font-size', '12px')
                .attr('fill', '#666')
                .text('Merged:');

            result.forEach((interval, i) => {
                const y = 105;
                
                svg.append('rect')
                    .attr('x', xScale(interval[0]))
                    .attr('y', y)
                    .attr('width', xScale(interval[1]) - xScale(interval[0]))
                    .attr('height', 30)
                    .attr('fill', colors[i % colors.length])
                    .attr('stroke', '#333')
                    .attr('stroke-width', 2)
                    .attr('rx', 5)
                    .attr('opacity', 0.8);

                svg.append('text')
                    .attr('x', (xScale(interval[0]) + xScale(interval[1])) / 2)
                    .attr('y', y + 20)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '12px')
                    .attr('font-weight', 'bold')
                    .attr('fill', '#fff')
                    .text(`[${interval[0]},${interval[1]}]`);
            });
        }

        function renderInput() {
            const container = document.getElementById('inputContainer');
            container.innerHTML = '';
            
            intervals.forEach((interval, i) => {
                const div = document.createElement('div');
                div.style.cssText = `
                    padding: 8px 15px;
                    background: ${i === currentIdx ? '#fff3e0' : (i < currentIdx ? '#e8f5e9' : '#fff')};
                    border: 2px solid ${i === currentIdx ? '#ff9800' : (i < currentIdx ? '#4caf50' : '#ddd')};
                    border-radius: 5px;
                    font-weight: ${i === currentIdx ? 'bold' : 'normal'};
                `;
                div.textContent = `[${interval[0]}, ${interval[1]}]`;
                if (i === currentIdx) div.textContent += ' â† current';
                container.appendChild(div);
            });
        }

        function renderResult() {
            const container = document.getElementById('resultContainer');
            
            if (result.length === 0) {
                container.innerHTML = '<span style="color: #666;">Empty</span>';
                return;
            }
            
            container.innerHTML = result.map((interval, i) => 
                `<div style="padding: 8px 15px; background: ${colors[i % colors.length]}; color: white; 
                border-radius: 5px; font-weight: bold;">
                    [${interval[0]}, ${interval[1]}]

        </div>`
            ).join('');
        }

        function step() {
            currentIdx++;
            
            if (currentIdx === 0) {
                // First interval goes directly to result
                result = [[...intervals[0]]];
                document.getElementById('statusMessage').textContent = 
                    `Step 1: Add first interval [${intervals[0][0]}, ${intervals[0][1]}] to result`;
                document.getElementById('comparisonDisplay').innerHTML = 
                    `Starting with first interval: [${intervals[0][0]}, ${intervals[0][1]}]`;
            } else if (currentIdx >= intervals.length) {
                document.getElementById('statusMessage').className = 'status-message success';
                document.getElementById('statusMessage').textContent = 
                    `âœ… Done! Merged ${intervals.length} intervals into ${result.length}: ${JSON.stringify(result)}`;
                document.getElementById('stepBtn').disabled = true;
                stopAuto();
                return;
            } else {
                const current = intervals[currentIdx];
                const prev = result[result.length - 1];
                
                if (current[0] <= prev[1]) {
                    // Overlapping - merge
                    const oldEnd = prev[1];
                    prev[1] = Math.max(prev[1], current[1]);
                    
                    document.getElementById('statusMessage').textContent = 
                        `Interval [${current[0]},${current[1]}] overlaps with [${prev[0]},${oldEnd}] â†’ Merge!`;
                    document.getElementById('comparisonDisplay').innerHTML = 
                        `<strong>Comparing:</strong><br>` +
                        `Current: [${current[0]}, ${current[1]}]<br>` +
                        `Last merged: [${prev[0]}, ${oldEnd}]<br>` +
                        `<span style="color: #ff9800;">Overlap! (${current[0]} â‰¤ ${oldEnd})</span><br>` +
                        `<strong>Result: Extend to [${prev[0]}, ${prev[1]}]</strong>`;
                } else {
                    // Not overlapping - add new
                    result.push([...current]);
                    
                    document.getElementById('statusMessage').textContent = 
                        `Interval [${current[0]},${current[1]}] doesn't overlap with [${prev[0]},${prev[1]}] â†’ Add new`;
                    document.getElementById('comparisonDisplay').innerHTML = 
                        `<strong>Comparing:</strong><br>` +
                        `Current: [${current[0]}, ${current[1]}]<br>` +
                        `Last merged: [${prev[0]}, ${prev[1]}]<br>` +
                        `<span style="color: #4caf50;">No overlap! (${current[0]} > ${prev[1]})</span><br>` +
                        `<strong>Result: Add [${current[0]}, ${current[1]}] as new interval</strong>`;
                }
            }
            
            renderTimeline();
            renderInput();
            renderResult();
        }

        function toggleAuto() {
            if (autoInterval) {
                stopAuto();
            } else {
                document.getElementById('autoBtn').textContent = 'Pause';
                autoInterval = setInterval(() => {
                    if (currentIdx >= intervals.length - 1) {
                        step();
                        stopAuto();
                    } else {
                        step();
                    }
                }, 1500);
            }
        }

        function stopAuto() {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }
            document.getElementById('autoBtn').textContent = 'Auto Run';
        }

        function reset() {
            stopAuto();
            result = [];
            currentIdx = -1;
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('statusMessage').className = 'status-message';
            document.getElementById('statusMessage').textContent = 'Click "Step" or "Auto Run" to start visualization';
            document.getElementById('comparisonDisplay').textContent = 'Waiting to start...';
            init();
        }

        init();
    </script>
</body>
</html>
