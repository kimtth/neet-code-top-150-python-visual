<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Number - LeetCode 136</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="problem-info">
            <h1><span class="problem-number">#0136</span> Single Number</h1>
            <p><strong>Problem:</strong> Given a non-empty array of integers nums, every element appears twice except for one. Find that single one.</p>
            <p><strong>Pattern:</strong> Bit Manipulation - XOR property: a ‚äï a = 0 and a ‚äï 0 = a</p>
            <div class="problem-meta">
                <span class="meta-tag">üíª Bit</span>
                <span class="meta-tag">‚è±Ô∏è O(n)</span>
            </div>
            <div class="file-ref">
                üìÑ Python: <code>python/0136_single_number/0136_single_number.py</code>
            </div>

        </div>

        <div class="explanation-panel">
            <h4>üß† How It Works (Layman's Terms)</h4>
            <p>Bit manipulation works with <strong>binary representations</strong>:</p>
            <ul>
                <li><strong>AND (&):</strong> Both bits must be 1</li>
                <li><strong>OR (|):</strong> At least one bit is 1</li>
                <li><strong>XOR (^):</strong> Bits must be different</li>
                <li><strong>Shift:</strong> Move bits left/right</li>
            </ul>
        </div>


        <div class="visualization-section">
            <h3>üé¨ Step-by-Step Visualization</h3>

            <div class="visualization">
            <svg id="mainSvg"></svg>
        </div>

        <div class="controls">
            <button id="stepBtn">Step</button>
            <button id="autoBtn">Auto Run</button>
            <button id="resetBtn">Reset</button>
            <div class="speed-control">
                <label for="speed">Speed:</label>
                <input type="range" id="speed" min="100" max="2000" value="800">
            </div>
        </div>

        <div class="status" id="status">Click "Step" or "Auto Run" to begin XOR operation</div>

        <div class="variables">
            <div class="var-item">
                <span class="var-label">Current Result (binary):</span>
                <span id="binaryDisplay" class="mono">00000000</span>
            </div>
            <div class="var-item">
                <span class="var-label">Current Result (decimal):</span>
                <span id="resultDisplay">0</span>
            </div>
        </div>

        </div>

        <div class="code-section">
            <h3>Python Solution</h3>
            <pre><span class="keyword">def</span> <span class="function">singleNumber</span>(nums):
    <span class="string">"""
    XOR all numbers together.
    Pairs cancel out (a ^ a = 0), leaving the single number.
    Time: O(n), Space: O(1)
    """</span>
    result = <span class="number">0</span>
    <span class="keyword">for</span> num <span class="keyword">in</span> nums:
        result ^= num  <span class="comment"># XOR operation</span>
    <span class="keyword">return</span> result</pre>
        </div>
    </div>

    <script>
        const nums = [4, 1, 2, 1, 2];
        let currentIndex = -1;
        let result = 0;
        let autoRunning = false;
        let autoTimer = null;

        const width = 800;
        const height = 350;
        const svg = d3.select("#mainSvg")
            .attr("width", width)
            .attr("height", height);

        const cellWidth = 70;
        const startX = (width - nums.length * cellWidth) / 2;

        function toBinary(n, bits = 8) {
            if (n < 0) n = (1 << bits) + n;
            return n.toString(2).padStart(bits, '0');
        }

        function drawArray() {
            svg.selectAll("*").remove();

            // Title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", 30)
                .attr("text-anchor", "middle")
                .attr("class", "title")
                .text(`nums = [${nums.join(", ")}]`);

            // Array cells
            const cells = svg.selectAll(".array-cell")
                .data(nums)
                .enter()
                .append("g")
                .attr("transform", (d, i) => `translate(${startX + i * cellWidth}, 50)`);

            cells.append("rect")
                .attr("width", cellWidth - 4)
                .attr("height", 50)
                .attr("rx", 5)
                .attr("class", "cell")
                .attr("id", (d, i) => `cell-${i}`);

            cells.append("text")
                .attr("x", (cellWidth - 4) / 2)
                .attr("y", 25)
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .attr("class", "cell-text")
                .text(d => d);

            // Binary representation below each number
            cells.append("text")
                .attr("x", (cellWidth - 4) / 2)
                .attr("y", 70)
                .attr("text-anchor", "middle")
                .attr("font-size", "10px")
                .attr("fill", "#666")
                .attr("font-family", "monospace")
                .text(d => toBinary(d));

            // Index labels
            cells.append("text")
                .attr("x", (cellWidth - 4) / 2)
                .attr("y", 90)
                .attr("text-anchor", "middle")
                .attr("class", "index-label")
                .text((d, i) => `[${i}]`);

            // XOR visualization area
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", 150)
                .attr("text-anchor", "middle")
                .attr("font-weight", "bold")
                .attr("fill", "#333")
                .text("XOR Operation Visualization");

            // Result area
            svg.append("rect")
                .attr("x", width / 2 - 100)
                .attr("y", 280)
                .attr("width", 200)
                .attr("height", 50)
                .attr("rx", 8)
                .attr("fill", "#e8f5e9")
                .attr("stroke", "#4caf50")
                .attr("stroke-width", 2)
                .attr("id", "resultBox");

            svg.append("text")
                .attr("x", width / 2)
                .attr("y", 310)
                .attr("text-anchor", "middle")
                .attr("font-size", "24px")
                .attr("font-weight", "bold")
                .attr("id", "resultText")
                .text(`Result: ${result}`);
        }

        function visualizeXOR(a, b, resultVal) {
            const binA = toBinary(a);
            const binB = toBinary(b);
            const binResult = toBinary(resultVal);
            
            const xorGroup = svg.append("g")
                .attr("class", "xor-viz")
                .attr("transform", `translate(${width/2 - 100}, 170)`);

            // Show the XOR operation
            const lineHeight = 25;
            
            xorGroup.append("text")
                .attr("x", 0)
                .attr("y", 0)
                .attr("font-family", "monospace")
                .attr("font-size", "16px")
                .text(`  ${binA}`);
            
            xorGroup.append("text")
                .attr("x", -20)
                .attr("y", 0)
                .attr("font-size", "14px")
                .attr("fill", "#666")
                .text(`${a}`);

            xorGroup.append("text")
                .attr("x", 0)
                .attr("y", lineHeight)
                .attr("font-family", "monospace")
                .attr("font-size", "16px")
                .text(`‚äï ${binB}`);
            
            xorGroup.append("text")
                .attr("x", 180)
                .attr("y", lineHeight)
                .attr("font-size", "14px")
                .attr("fill", "#666")
                .text(`(XOR with ${b})`);

            xorGroup.append("line")
                .attr("x1", 0)
                .attr("y1", lineHeight + 10)
                .attr("x2", 130)
                .attr("y2", lineHeight + 10)
                .attr("stroke", "#333")
                .attr("stroke-width", 2);

            xorGroup.append("text")
                .attr("x", 0)
                .attr("y", lineHeight * 2 + 10)
                .attr("font-family", "monospace")
                .attr("font-size", "16px")
                .attr("font-weight", "bold")
                .attr("fill", "#4caf50")
                .text(`  ${binResult}`);
            
            xorGroup.append("text")
                .attr("x", 180)
                .attr("y", lineHeight * 2 + 10)
                .attr("font-size", "14px")
                .attr("fill", "#4caf50")
                .attr("font-weight", "bold")
                .text(`= ${resultVal}`);
        }

        function step() {
            if (currentIndex >= nums.length - 1) return false;

            svg.selectAll(".xor-viz").remove();
            currentIndex++;
            
            const prevResult = result;
            result ^= nums[currentIndex];

            // Update displays
            document.getElementById("binaryDisplay").textContent = toBinary(result);
            document.getElementById("resultDisplay").textContent = result;

            // Highlight current cell
            svg.selectAll(".cell").attr("class", "cell");
            d3.selectAll(".cell").filter((d, i) => i <= currentIndex)
                .attr("class", "cell processed");
            svg.select(`#cell-${currentIndex}`).attr("class", "cell current");

            // Visualize XOR
            visualizeXOR(prevResult, nums[currentIndex], result);

            // Update result box
            svg.select("#resultText").text(`Result: ${result}`);

            if (currentIndex === nums.length - 1) {
                document.getElementById("status").textContent = 
                    `Complete! The single number is ${result}`;
                svg.select("#resultBox")
                    .attr("fill", "#c8e6c9")
                    .attr("stroke", "#2e7d32");
                return false;
            } else {
                document.getElementById("status").textContent = 
                    `Step ${currentIndex + 1}: ${prevResult} XOR ${nums[currentIndex]} = ${result}`;
                return true;
            }
        }

        function reset() {
            currentIndex = -1;
            result = 0;
            autoRunning = false;
            if (autoTimer) clearInterval(autoTimer);
            
            document.getElementById("binaryDisplay").textContent = "00000000";
            document.getElementById("resultDisplay").textContent = "0";
            document.getElementById("status").textContent = 'Click "Step" or "Auto Run" to begin XOR operation';
            document.getElementById("autoBtn").textContent = "Auto Run";
            
            drawArray();
        }

        function autoRun() {
            if (autoRunning) {
                autoRunning = false;
                clearInterval(autoTimer);
                document.getElementById("autoBtn").textContent = "Auto Run";
            } else {
                autoRunning = true;
                document.getElementById("autoBtn").textContent = "Pause";
                const speed = 2100 - document.getElementById("speed").value;
                autoTimer = setInterval(() => {
                    if (!step()) {
                        autoRunning = false;
                        clearInterval(autoTimer);
                        document.getElementById("autoBtn").textContent = "Auto Run";
                    }
                }, speed);
            }
        }

        document.getElementById("stepBtn").addEventListener("click", step);
        document.getElementById("autoBtn").addEventListener("click", autoRun);
        document.getElementById("resetBtn").addEventListener("click", reset);

        drawArray();
    </script>

    <style>
        .mono { font-family: 'Consolas', monospace; }
        .cell { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
        .cell.current { fill: #fff3e0; stroke: #f57c00; stroke-width: 3; }
        .cell.processed { fill: #e8f5e9; stroke: #4caf50; stroke-width: 2; }
        .cell-text { font-size: 20px; font-weight: bold; fill: #333; }
        .index-label { font-size: 12px; fill: #666; }
    </style>
</body>
</html>
